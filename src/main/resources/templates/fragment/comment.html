<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<div class="comment-list mt-4" th:if="${!comments.isEmpty()}" th:fragment="comment">
  <h5>댓글 리스트</h5>
  <div th:each="comment : ${comments}">
    <div class="card mb-3">
      <div class="card-body">
        <p class="card-text" th:text="${comment.content}"></p>
        <p class="card-text">
          <small class="text-muted">작성자: <span th:text="${comment.member.nickname}"></span> | <span th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm')}"></span></small>
        </p>
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <form th:action="@{/comment/star/add/{boardId}/{id}(id=${comment.id}, boardId=${board.id})}" th:method="post" style="display:inline;">
              <input type="hidden" name="boardName" value="free-board">
              <button type="submit" class="btn btn-outline-primary btn-sm">
                <i class="bi bi-hand-thumbs-up"></i> <span th:text="${comment.starCount}"></span>
              </button>
            </form>
          </div>
          <div th:if="${#authentication != null and #authentication.name == comment.member.email}">
            <!-- 수정 버튼 -->
            <button class="btn btn-outline-secondary btn-sm" style="border: none; background: none;" onclick="editComment(${comment.id})">
              <i class="bi bi-pencil"></i>
            </button>
            <!-- 삭제 버튼 -->
            <form th:action="@{/comment/delete/{id}(id=${comment.id})}" th:method="post" style="display: inline;">
              <button type="submit" class="btn btn-outline-danger btn-sm" style="border: none; background: none;">
                <i class="bi bi-trash"></i>
              </button>
            </form>
          </div>
        </div>
        <!-- 대댓글 작성 버튼 및 폼 -->
        <div class="mt-2">
          <button class="btn btn-outline-secondary btn-sm"  style="border: none; background: none;" onclick="toggleReplyForm(${comment.id})">대댓글 작성</button>
          <div id="replyForm-${comment.id}" class="reply-form mt-2" style="display: none;">
            <form th:action="@{/comment/add/{commentId}(commentId=${comment.id})}" th:method="post">
              <input type="hidden" name="boardName" value="free-board">
              <div class="input-group">
                <input type="text" class="form-control" name="replyContent" placeholder="대댓글을 작성하세요">
                <button class="btn btn-outline-secondary" type="submit">작성</button>
              </div>
            </form>
          </div>
        </div>
        <!-- 대댓글 리스트 -->
        <div class="reply-list mt-3" th:if="${!comment.replies.isEmpty()}">
          <h6>대댓글</h6>
          <div th:each="reply : ${comment.replies}">
            <div class="card mb-2">
              <div class="card-body">
                <p class="card-text" th:text="${reply.content}"></p>
                <p class="card-text">
                  <small class="text-muted">작성자: <span th:text="${reply.member.nickname}"></span> | <span th:text="${#temporals.format(reply.createdAt, 'yyyy-MM-dd HH:mm')}"></span></small>
                </p>
                <div class="d-flex justify-content-between align-items-center">
                  <div th:if="${#authentication != null and #authentication.name == reply.member.email}">
                    <!-- 대댓글 수정 버튼 -->
                    <button class="btn btn-outline-secondary btn-sm" style="border: none; background: none;" onclick="editReply(${reply.id})">
                      <i class="bi bi-pencil"></i>
                    </button>
                    <!-- 대댓글 삭제 버튼 -->
                    <form th:action="@{/reply/delete/{id}(id=${reply.id})}" th:method="post" style="display: inline;">
                      <button type="submit" class="btn btn-outline-danger btn-sm" style="border: none; background: none;">
                        <i class="bi bi-trash"></i>
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- 대댓글 리스트 끝 -->
      </div>
    </div>
  </div>
</div>

<!-- JavaScript for toggling the reply form visibility -->
<script>
  function toggleReplyForm(commentId) {
    var form = document.getElementById('replyForm-' + commentId);
    if (form.style.display === 'none' || form.style.display === '') {
      form.style.display = 'block';
    } else {
      form.style.display = 'none';
    }
  }
</script>
</body>
</html>
